# ETL
ETL-пайплайн на AWS
Цель проекта
Проект реализует автоматизированный ETL-процесс с использованием облачных сервисов Amazon Web Services. Основная задача — извлекать транзакционные данные в формате CSV, преобразовывать их в удобный формат Parquet, сохранять в отдельное хранилище и делать доступными для аналитики через SQL-запросы в Amazon Athena.

Компоненты архитектуры
1. Amazon S3

Используется как основное хранилище данных:

Папка /raw/ содержит исходные CSV-файлы

Папка /processed/ хранит обработанные данные в формате Parquet

2. AWS Glue Crawler

Сканирует содержимое S3 /raw/ и автоматически создаёт таблицу raw в базе данных raw_database. Это позволяет Glue Job понять структуру данных без необходимости вручную описывать схему.

3. AWS Glue Job

Обрабатывает данные следующим образом:

Чтение таблицы raw как DynamicFrame

Приведение столбцов к нужным типам (например, userid из string в int)

Очистка данных (удаление строк с ошибками и пропусками)

Сохранение результата в формате Parquet в S3 (/processed/)

4. Amazon Athena

Позволяет выполнять SQL-запросы к данным, сохранённым в S3. Используется для построения отчётов и аналитики.

Пример сценария использования
Загружается файл transactions.csv в s3://my-etl-pipeline-bucket-512/raw/

Запускается Glue Crawler, создающая таблицу raw

Запускается Glue Job transform_job, который сохраняет обработанные данные в s3://my-etl-pipeline-bucket-512/processed/

В Athena создаётся таблица processed с указанием пути к processed/

Выполняется запрос, например:

sql
Копировать
Редактировать
SELECT country, COUNT(*) AS total_transactions
FROM processed
GROUP BY country
ORDER BY total_transactions DESC;
Проблемы и их решения
RESOURCE_NOT_FOUND_ERROR — возникает, если таблица raw ещё не создана. Решение: запустить Glue Crawler.

UNRESOLVED_COLUMN — ошибка в названии столбца. Важно использовать точные имена из схемы, например numberofitemspurchased, а не NumberOfItemPurchased.

NameError: DynamicFrame — отсутствует импорт библиотеки. Решение: добавить from awsglue.dynamicframe import DynamicFrame.

PERMISSION_ERROR — ошибка доступа при записи в S3. Решение: проверить IAM роль Glue и добавить политику s3:PutObject.

HIVE_BAD_DATA: Not valid Parquet — ошибка возникает, если в каталоге находятся CSV-файлы, а Athena ожидает .parquet. Решение: убедиться, что Athena работает только с обработанными .parquet-файлами, и указать правильный путь к ним.

Заключение
Этот пайплайн позволяет эффективно автоматизировать обработку больших объёмов данных, минимизируя ручную работу и повышая надёжность. Использование Glue и Athena делает возможным масштабирование, быструю трансформацию данных и мгновенный доступ к аналитике через SQL.
